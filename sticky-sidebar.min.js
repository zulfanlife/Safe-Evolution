!function(i){function t(e,s){this.options=i.extend({},t.DEFAULTS,s),this.$sidebar=i(e),this.$sidebarInner=!1,this.$container=this.$sidebar.closest(this.options.containerSelector),this.affixedType="static",this._initialized=!1,this._breakpoint=!1,this._resizeListeners=[],this.dimensions={translateY:0,topSpacing:0,bottomSpacing:0,sidebarHeight:0,sidebarWidth:0,containerTop:0,containerHeight:0,viewportHeight:0,viewportTop:0,lastViewportTop:0},this.initialize()}function e(e){return this.each(function(){var s=i(this),n=i(this).data("stickySidebar");if(n||(n=new t(this,"object"==typeof e&&e),s.data("stickySidebar",n)),"string"==typeof e){if(void 0===n[e]&&-1!=["destory","updateSticky"].indexOf(e))throw new Error('No method named "'+e+'"');n[e]()}})}var s=i(window);t.VERSION="1.0.0",t.EVENT_KEY=".stickySidebar",t.DEFAULTS={topSpacing:0,bottomSpacing:0,containerSelector:!1,innerWrapperClass:"inner-wrapper-sticky",stickyClass:"is-affixed",resizeSensor:!0,minWidth:!1},t.isIE=function(){return Boolean(navigator.userAgent.match(/Trident/))},t.supportTransform=function(t){var e=!1,s=t?"perspective":"transform",n=s.charAt(0).toUpperCase()+s.slice(1),o="Webkit Moz O ms".split(" "),r=i("<support>").get(0).style;return i.each((s+" "+o.join(n+" ")+n).split(" "),function(i,t){return void 0!==r[t]?(e=t,!1):void 0}),e},t.prototype={initialize:function(){if(this.$sidebar.trigger("initialize"+t.EVENT_KEY),this.options.innerWrapperClass&&(this.$sidebarInner=this.$sidebar.find("."+this.options.innerWrapperClass),0===this.$sidebarInner.length&&(this.$sidebarInner=!1)),!this.$sidebarInner){var e=i('<div class="'+this.options.innerWrapperClass+'" />'),s="> div";this.options.innerWrapSelector&&(s="."+this.options.innerWrapSelector),this.$sidebar.wrapInner(e),this.$sidebarInner=this.$sidebar.find(s)}this.$container.length||(this.$container=this.$sidebar.parent()),"function"!=typeof this.options.topSpacing&&(this.options.topSpacing=parseInt(this.options.topSpacing)||0),"function"!=typeof this.options.bottomSpacing&&(this.options.bottomSpacing=parseInt(this.options.bottomSpacing)||0),this._widthBreakpoint(),this.calcDimensions(),this.stickyPosition(),this.bindEvents(),this._initialized=!0,this.$sidebar.trigger("initialized"+t.EVENT_KEY)},bindEvents:function(){this.options,s.on("resize."+t.EVENT_KEY,i.proxy(this._onResize,this)).on("scroll."+t.EVENT_KEY,i.proxy(this._onScroll,this)),this.$sidebar.on("recalcDimenstions."+t.EVENT_KEY,i.proxy(this.updateSticky,this)),this.options.resizeSensor&&(this.addResizerListener(this.$sidebarInner,i.proxy(this.updateSticky,this)),this.addResizerListener(this.$container,i.proxy(this.updateSticky,this)))},_onScroll:function(){this.$sidebar.is(":visible")&&this.animateSticky()},_onResize:function(){requestAnimationFrame(i.proxy(function(){this._widthBreakpoint(),this.updateSticky()},this))},calcDimensions:function(){if(!this._breakpoint){var i=this.dimensions;i.containerTop=this.$container.offset().top,i.containerHeight=this.$container.outerHeight(),i.containerBottom=i.containerTop+i.containerHeight,i.sidebarHeight=this.$sidebarInner.outerHeight(),i.sidebarWidth=this.$sidebar.outerWidth(),i.viewportHeight=s.prop("innerHeight"),this._calcDimensionsWithScroll()}},_calcDimensionsWithScroll:function(){var i=this.dimensions;i.sidebarLeft=this.$sidebar.offset().left,i.viewportTop=document.documentElement.scrollTop||document.body.scrollTop,i.viewportBottom=i.viewportTop+i.viewportHeight,i.viewportLeft=document.documentElement.scrollLeft||document.body.scrollLeft,i.topSpacing=this.options.topSpacing,i.bottomSpacing=this.options.bottomSpacing,"function"==typeof i.topSpacing&&(i.topSpacing=parseInt(i.topSpacing(this.$sidebar))||0),"function"==typeof i.bottomSpacing&&(i.bottomSpacing=parseInt(i.bottomSpacing(this.$sidebar))||0)},isSidebarFitsViewport:function(){return this.dimensions.sidebarHeight<this.dimensions.viewportHeight},isScrollingTop:function(){return this.dimensions.viewportTop<this.dimensions.lastViewportTop},getAffixType:function(){var i=this.dimensions,t=!1;this._calcDimensionsWithScroll();var e=i.sidebarHeight+i.containerTop,s=i.viewportTop+i.topSpacing,n=i.viewportBottom-i.bottomSpacing;return this.isScrollingTop()?s<=i.containerTop?(i.translateY=0,t="STATIC"):s<=i.translateY+i.containerTop?(i.translateY=s-i.containerTop,t="VIEWPORT-TOP"):!this.isSidebarFitsViewport()&&i.containerTop<=s&&(t="VIEWPORT-UNBOTTOM"):this.isSidebarFitsViewport()?i.sidebarHeight+s>=i.containerBottom?(i.translateY=i.containerBottom-e,t="CONTAINER-BOTTOM"):s>=i.containerTop&&(i.translateY=s-i.containerTop,t="VIEWPORT-TOP"):i.containerBottom<=n?(i.translateY=i.containerBottom-e,t="CONTAINER-BOTTOM"):e+i.translateY<=n?(i.translateY=n-e,t="VIEWPORT-BOTTOM"):i.containerTop+i.translateY<=s&&(t="VIEWPORT-UNBOTTOM"),i.lastViewportTop=i.viewportTop,t},_getStyle:function(e){if(void 0!==e){var s={inner:{},outer:{}},n=this.dimensions;switch(e){case"VIEWPORT-TOP":s.inner={position:"fixed",top:this.options.topSpacing,left:n.sidebarLeft-n.viewportLeft,width:n.sidebarWidth};break;case"VIEWPORT-BOTTOM":s.inner={position:"fixed",top:"auto",left:n.sidebarLeft,bottom:this.options.bottomSpacing,width:n.sidebarWidth};break;case"CONTAINER-BOTTOM":case"VIEWPORT-UNBOTTOM":s.inner={position:"absolute",top:n.containerTop+n.translateY},t.supportTransform(translate3d=!0)?s.inner={transform:"translate3d(0, "+n.translateY+"px, 0)"}:t.supportTransform()&&(s.inner={transform:"translate(0, "+n.translateY+"px)"})}switch(e){case"VIEWPORT-TOP":case"VIEWPORT-BOTTOM":case"VIEWPORT-UNBOTTOM":case"CONTAINER-BOTTOM":s.outer={minHeight:n.translateY+n.sidebarHeight}}return s.outer=i.extend({},{minHeight:""},s.outer),s.inner=i.extend({},{position:"relative",top:"",left:"",bottom:"",width:"",transform:""},s.inner),s}},stickyPosition:function(){if(this.$sidebar.is(":visible")&&!this._breakpoint){var e=(this.options.topSpacing,this.options.bottomSpacing,this.getAffixType()),s=this._getStyle(e);if(this.affixedType!=e&&e){var n=i.Event("affix."+e.replace("viewport-","")+t.EVENT_KEY);this.$sidebar.trigger(n),"static"===e?this.$sidebar.removeClass(this.options.stickyClass):this.$sidebar.addClass(this.options.stickyClass);var o=i.Event("affixed."+e.replace("viewport","")+t.EVENT_KEY);this.$sidebarInner.css(s.inner),this.$sidebar.trigger(o)}this._initialized&&this.$sidebarInner.css("left",s.inner.left),this.$sidebar.css(s.outer),this.affixedType=e}},_widthBreakpoint:function(){s.innerWidth()<=this.options.minWidth?(this._breakpoint=!0,this.affixedType="static",this.$sidebar.removeAttr("style").removeClass(this.options.stickyClass),this.$sidebarInner.removeAttr("style")):this._breakpoint=!1},updateSticky:function(){this.calcDimensions(),this.stickyPosition()},animateSticky:function(){requestAnimationFrame(i.proxy(function(){this.stickyPosition()},this))},addResizerListener:function(t,e){var s=i(t);s.prop("resizeListeners")||(s.prop("resizeListeners",[]),this._appendResizeSensor(s)),s.prop("resizeListeners").push(e)},removeResizeListener:function(t,e){var s=i(t),n=s.prop("resizeListeners"),o=n.indexOf(e);if(this._resizeListeners.splice(o,1),s.prop("resizeListeners").length){var r=s.prop("resizeTrigger");i(r.contentDocument.defaultView).off("resize",this._resizeListener),r=s.find(r).remove()}},_appendResizeSensor:function(e){var s=i(e);"static"==s.css("position")&&s.css("position","relative");var n=i("<object>");n.attr("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%;overflow: hidden; pointer-events: none; z-index: -1;"),n.prop("resizeElement",s[0]);var o=this;n.on("load",function(){this.contentDocument.defaultView.resizeTrigger=this.resizeElement,i(this.contentDocument.defaultView).on("resize",o._resizeListener)}),n.prop("type","text/html"),t.isIE()&&n.prop(data,"about:blank"),s.prop("resizeTrigger",n.get(0)),s.append(n)},_resizeListener:function(i){var t=i.target||i.srcElement;cancelAnimationFrame(t.resizeSensorRAF),t.resizeSensorRAF=requestAnimationFrame(function(){var e=t.resizeTrigger;e.resizeListeners.forEach(function(t){t.call(e,i)})})},destroy:function(){s.off("resize"+t.EVENT_KEY).off("scroll"+t.EVENT_KEY),this.$sidebar.removeClass(this.options.stickyClass).css({minHeight:""}).off("recalcDimenstions"+t.EVENT_KEY).removeData("stickySidebar"),this.$sidebarInner.css({position:"",top:"",left:"",bottom:"",width:"",transform:""}),this.options.resizeSensor&&(this.removeResizeListener(this.$sidebarInner,i.proxy(this.updateSticky,this)),this.removeResizeListener(this.$container,i.proxy(this.updateSticky,this)))}},i.fn.stickySidebar=e,i.fn.stickySidebar.Constructor=t;var n=i.fn.stickySidebar;i.fn.stickySidebar.noConflict=function(){return i.fn.stickySidebar=n,this},s.on("load",function(){i("[data-sticky-sidebar]").each(function(){var t=i(this),s=t.data()||{},n=t.closest("[data-sticky-sidebar-container]");n.length&&(s.containerSelector=n),e.call(t,s)})})}(jQuery);